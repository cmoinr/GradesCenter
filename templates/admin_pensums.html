{% extends "layout.html" %}

{% block title %}
    Admin | Pensums
{% endblock %}

{% block main %}
    <div class="mb-3">
        <h3>Pensums</h3>
        <h6>All subjects</h6>
    </div>
    <div class="mb-3">
        <button class="btn btn-primary" id="new_strategy" type="button" onclick="addStrategies()">Add New Subject</button>
        <form id="add_Strategies" style="display: none;" action="/admin_subjects" method="POST">
            <input type="text" name="subject_id" placeholder="ID" required>
            <br><br>
            <input type="text" name="name" placeholder="Name" required>
            <br><br>
            <select id="faculty_select" name="department">
                <option disabled selected>Department</option>
                <option value="SE70">Systems Engineering</option>
                <option value="ME02">Medicine</option>
                <option value="EC03">Economics</option>
                <option value="DE04">Dentistry</option>
                <option value="AG05">Agronomy</option>
                <option value="SC06">Social Communication</option>
                <option value="PO90">Politics</option>
            </select>
            <br><br>
            <select id="semester_select" name="semester">
                <option disabled selected>Semester</option>
                {% for i in range(1, 13) %}
                <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
            <br><br>
            <input type="number" name="credits" placeholder="Credits" required>
            <br><br>
            <input type="number" name="sections" placeholder="Sections" required>
            <br><br>
            <input class="btn" id="strategy_save" type="submit" value="Save">
        </form>

        <table>
            <thead>
                <tr class="high">
                    <th>ID</th>
                    <th>Name <input class="filter" type="text" id="filterName" placeholder="filter"></th>
                    <th>Faculty <select class="filter" id="filterFaculty"><option value="">All</option><option value="Systems Engineering">Systems Engineering</option><option value="Medicine">Medicine</option><option value="Economics">Economics</option><option value="Dentistry">Dentistry</option><option value="Agronomy">Agronomy</option><option value="Social Communication">Social Communication</option><option value="Politics">Politics</option></select></th>
                    <th>Semester <select class="filter" id="filterSemester"><option value="">All</option>{% for i in range(1, 13) %}<option value="{{ i }}">{{ i }}</option>{% endfor %}</select></th>
                    <th>Credits <input class="filter" type="number" id="filterCredits" placeholder="filter"></th>
                    <th>Sections</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for subject in subjects %}
                    <tr>
                        <td>{{ subject['id'] }}</td>
                        <td>{{ subject['name'] }}</td>
                        <td>{{ subject['field'] }}</td>
                        <td>{{ subject['semester'] }}</td>
                        <td>{{ subject['credits'] }}</td>
                        <td>{{ subject['sections'] }}</td>
                        <td>                     
                            <button class="btn btn-primary" type="button" onclick="editStrategies(this)">Edit</button>
                            <form id="edit_Strategies" style="display: none;" action="/admin_subjects" method="post">
                                <input id="edit_strategy_form" type="hidden" name="editing_id" value="{{ subject['id'] }}">
                                <input id="edit_strategy_form" type="text" name="editing_name" value="{{ subject['name'] }}" placeholder="Name" required>                                
                                <input id="edit_strategy_form" type="number" name="editing_semester" value="{{ subject['semester'] }}" placeholder="Semester" min="1" required>
                                <input id="edit_strategy_form" type="number" name="editing_credits" value="{{ subject['credits'] }}" placeholder="Credits" required>
                                <input id="edit_strategy_form" type="number" name="editing_sections" value="{{ subject['sections'] }}" placeholder="Sections" required>
                                <input class="btn" id="strategy_save2" type="submit" value="Save">
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <script>
            function addStrategies() {
                document.getElementById("add_Strategies").style.display = "block";
            }

            function editStrategies(button) {
                button.style.display = "none";
                var form = button.nextElementSibling;
                form.style.display = "block";
            }
        </script>
    </div>

    <script>
        const filterName = document.getElementById('filterName');
        const filterFaculty = document.getElementById('filterFaculty');
        const filterSemester = document.getElementById('filterSemester');
        const filterCredits = document.getElementById('filterCredits');
      
        function filterTable() {
          const rows = document.querySelectorAll('table tbody tr');
          const nameFilter = filterName.value.toLowerCase();
          const facultyFilter = filterFaculty.value;
          const semesterFilter = filterSemester.value;
          const creditsFilter = filterCredits.value;
      
          rows.forEach(row => {
            const nameCell = row.cells[1];
            const facultyCell = row.cells[2];
            const semesterCell = row.cells[3];
            const creditsCell = row.cells[4];
            const nameMatch = nameCell.textContent.toLowerCase().includes(nameFilter);
            const facultyMatch = !facultyFilter || facultyCell.textContent === facultyFilter;
            const semesterMatch = !semesterFilter || semesterCell.textContent === semesterFilter;
            const creditsMatch = !creditsFilter || creditsCell.textContent === creditsFilter;
            row.style.display = nameMatch && facultyMatch && semesterMatch && creditsMatch ? '' : 'none';
          });
        }
      
        filterName.addEventListener('keyup', filterTable);
        filterFaculty.addEventListener('change', filterTable);
        filterSemester.addEventListener('change', filterTable);
        filterCredits.addEventListener('keyup', filterTable);
    </script>
{% endblock %}